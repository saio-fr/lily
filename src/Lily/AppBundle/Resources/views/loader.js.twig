(function (window, document, undefined) {"use strict";!function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d=c(1),e=c(7),f=c(8),g=c(5),h=c(9),i=c(3),j=window.saio||[];if(i.isUnsuported())throw Error("Navigator unsupported");var k=(j&&j.SNIPPET_VERSION?parseFloat(j.SNIPPET_VERSION,10):0,e().initialize()),l=d().initialize(),m=f().initialize();for(g.registerApp(k,"host"),g.registerApp(l,"lily"),g.registerApp(m,"widget");j&&j.length>0;){var n=j.shift(),o=n.shift();saio[o]&&(h[o].apply(saio,n),h.calledBeforeLoad=!0)}window.saio=h},function(a,b,c){var d=c(2),e=c(5),f=c(6),g=c(3),h='{{ url("lily_app_index", { licence: licence }) }}',i={tagName:"iframe",attrs:{id:"lilyApp",allowTransparency:"true",frameBorder:"0",scrolling:"yes",name:"saio_lily_app",role:"dialog",src:h},container:{tagName:"div",attrs:{id:"lilyAppContainer"},styles:{display:"none"}}};a.exports=function(){var a=g.extend(d(),{uid:"lily",target:h,origin:g.getOrigin(h),host:g.getHost(h),frame:void 0,el:void 0,elOptions:i,id:i.container.attrs.id,frameId:i.attrs.id,shouldOpenStandalone:!1,events:{"lily.load":"onLoad","lily.ready":"onReady","lily.expand":"onExpand","lily.shrink":"onShrink","lily.onWidgetShow":"onWidgetShow","lily.sendMessageToVisitor":"sendMessageToVisitor","lily.addAviMessage":"addAviMessage","lily.setOperatorGroup":"setOperatorGroup","lily.messageToOperator":"onMessageToOperator"},state:{load:!1,ready:!1,shown:!1,firstOpen:!0},initialize:function(){return this.el=this.render(this.elOptions),this.frame=document.getElementById(this.frameId).contentWindow,this.delegateEvents(e,this.events,this),this.forwardStateChangeEvents(e,this.state,this),this},render:function(a){if(a){var b=a.container?this.createEl(a.container):null,c=a?this.createEl(a):null,d=document.body;return this.insertInContainer(b,d),this.insertInContainer(c,b),b}},onLoad:function(a){a.shouldOpenStandalone&&(this.shouldOpenStandalone=!0),this.setState("load",!0),this.sendMessage("host.sendInfo",{host:window.location.host||null,path:window.location.pathname||null,href:window.location.href||null,protocol:window.location.protocol||null,referrer:document.referrer||null})},onReady:function(a){this.setState("ready",!0),a&&(this.setState("activeRoute",a.activeRoute),a.displayApp?this.onExpand():e.trigger("widget.show"))},onWidgetShow:function(){this.sendMessage("widget.shown",{firstShow:this.getState("firstShow")})},onMessageToOperator:function(a){g.isString(a)&&this.trigger("lily.onMessageToOperator",a)},setOperatorGroup:function(a){this.sendMessage("config.setOperatorGroup",a)},onExpand:function(){var a=this.getState("firstOpen");return this.shouldOpenStandalone?this.standaloneOpen():this.getState("ready")?(this.show(),this.setState("shown",!0),e.trigger("widget.hide"),this.show(),this.sendMessage("lily.shown",{firstOpen:a}),this.setState("firstOpen",!1),void e.trigger("lily.onExpand")):e.once("lily.onReady",this.onExpand,this)},onShrink:function(){this.shouldOpenStandalone||(this.hide(),this.setState("shown",!1),e.trigger("widget.show"),e.trigger("lily.onShrink"))},sendMessageToVisitor:function(a){this.sendMessage("lily.sendMessageToVisitor",a)},addAviMessage:function(a){this.sendMessage("lily.addAviMessage",a)},standaloneOpen:function(){var a=window.open(this.target,"_blank");a.focus()}},f);return a}},function(a,b,c){var d=c(3),e=c(4);a.exports=function(){function a(a,b){var c=[];d.each(b,function(a,b){c.push(b+":"+a+" !important")}),a.style.cssText=c.join(";")}function b(){this._setInlineStyleCompat({})}var c={events:{},state:{},initialize:function(){},render:function(){return this.el},getState:function(a){return this.state[a]},setState:function(a,b){var c=this.state[a];this.state[a]=b,"undefined"!=typeof c&&b!==c&&(this.trigger("change",this.state),this.trigger("change:"+a,b))},createEl:function(a){var b=document.createElement(a.tagName||"div");return b.innerHTML=a.html||"",this.setAttributes(b,a.attrs),this.setInlineStyle(b,a.styles),b},insertInContainer:function(a,b){return d.isString(b)&&(b=document.getElementById(b)),b.appendChild(a)},hide:function(){this.setInlineStyle(this.el,"display","none"),window.focus()},show:function(){this.removeInlineStyle(this.el,"display")},setAttributes:function(a,b){d.each(b,function(b,c){a.setAttribute(c,b)})},setInlineStyle:function(b,c,e){var f={},g=b.style;d.isString(c)?f[c]=e:f=c,"setProperty"in g?d.each(f,function(a,b){g.setProperty(b,""+a,"important")}):a(b,f)},removeInlineStyle:function(a,c){var d=a.style;"removeProperty"in d?d.removeProperty(c):b(c)},delegateEvents:function(a,b,c){if(!b)return this;this.undelegateEvents(a||this);for(var e in b){var f=b[e];d.isFunction(f)||(f=this[f]),f&&this.listenTo(a||this,e,d.bind(f,c||this))}return this},undelegateEvents:function(a){this.stopListening(a||this)},forwardStateChangeEvents:function(a,b,c){d.each(b,function(b,d){var e="change:"+d;c.on(e,function(){var b=[].slice.call(arguments);b.unshift(this.uid+"."+e),a.trigger.apply(a,b)})})},removeEl:function(){return this.el&&this.el.parentNode.removeChild(this.el),this},remove:function(){return this.removeEl(),this.stopListening(),this}};return d.extend(c,e),c}},function(a,b){a.exports=function(){var a=[].slice,b={}.toString,c={isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},isObject:function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},isFunction:function(a){return"function"!=typeof/./&&"object"!=typeof Int8Array?"function"==typeof a||!1:"[object Function]"===b.call(a)},isString:function(a){return"[object String]"===b.call(a)},isOwn:function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},bind:function(b,c){if(!this.isFunction(b))return void 0;var d=a.call(arguments,2);return function(){return b.apply(c||this,d.concat(a.call(arguments)))}},each:function(a,b){var d,e;if(c.isArray(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else for(var f in a)a.hasOwnProperty(f)&&b(a[f],f,a)},extend:function(a){if(!this.isObject(a))return a;for(var b,c,d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)if(Object.getOwnPropertyDescriptor&&Object.defineProperty){var f=Object.getOwnPropertyDescriptor(b,c);Object.defineProperty(a,c,f)}else a[c]=b[c]}return a},throttle:function(a,b,d){var e,f,g,h=null,i=0;d||(d={});var j=function(){i=d.leading===!1?0:c.now(),h=null,g=a.apply(e,f),h||(e=f=null)};return function(){var k=c.now();i||d.leading!==!1||(i=k);var l=b-(k-i);return e=this,f=arguments,0>=l||l>b?(h&&(clearTimeout(h),h=null),i=k,g=a.apply(e,f),h||(e=f=null)):h||d.trailing===!1||(h=setTimeout(j,l)),g}},debounce:function(a,b,d){var e,f,g,h,i,j=function(){var k=c.now()-h;b>k&&k>=0?e=setTimeout(j,b-k):(e=null,d||(i=a.apply(g,f),e||(g=f=null)))};return function(){g=this,f=arguments,h=c.now();var k=d&&!e;return e||(e=setTimeout(j,b)),k&&(i=a.apply(g,f),g=f=null),i}},once:function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},keys:function(a){if(!c.isObject(a))return[];if(Object.keys)return Object.keys(a);var b=[];for(var d in a)c.has(a,d)&&b.push(d);return b},addEvent:function(a,b,c){window.addEventListener?a.addEventListener(b,c,!1):window.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},removeEvent:function(a,b,c){window.removeEventListener?a.removeEventListener(b,c,!1):window.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null},stopPropagation:function(a){var b=a||window.event;b.cancelBubble=!0,b.stopPropagation&&b.stopPropagation()},isMsie:function(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var a=+RegExp.$1;if(10>a)return!0}},isUnsuported:function(){if(this.isMsie())return!0;if(!window.postMessage)return!0;if(!window.JSON)return!0;try{window.postMessage("ping","*")}catch(a){return!0}return!1},emptyLink:window.document.createElement("a"),getHost:function(a){return this.emptyLink.href=a,this.emptyLink.hostname},getOrigin:function(a){this.emptyLink.href=a;var b=this.emptyLink.href.split("/");return b[0]+"//"+b[2]},now:Date.now};return c}()},function(a,b,c){var d=c(3),e=[].slice,f=0;d.uniqueId=function(a){var b=++f+"";return a?a+b:b};var g={on:function(a,b,c){if(!i(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!i(this,"once",a,[b,c])||!b)return this;var f=this,g=d.once(function(){var c=e.call(arguments);f.off(a,g),b.apply(this,c)});return g._callback=b,this.on(a,g,c)},off:function(a,b,c){var e,f,g,h,j,k,l,m;if(!this._events||!i(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events=void 0,this;for(h=a?[a]:d.keys(this._events),j=0,k=h.length;k>j;j++)if(a=h[j],g=this._events[a]){if(this._events[a]=e=[],b||c)for(l=0,m=g.length;m>l;l++)f=g[l],(b&&b!==f.callback&&b!==f.callback._callback||c&&c!==f.context)&&e.push(f);e.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=e.call(arguments,1);if(!i(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&j(c,b),d&&j(d,arguments),this},stopListening:function(a,b,c){var e=this._listeningTo;if(!e)return this;var f=!b&&!c;c||"object"!=typeof b||(c=this),a&&((e={})[a._listenId]=a);for(var g in e)a=e[g],a.off(b,c,this),(f||d.isEmpty(a._events))&&delete this._listeningTo[g];return this}},h=/\s+/,i=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(h.test(c)){for(var f=c.split(h),g=0,i=f.length;i>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},j=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},k={listenTo:"on",listenToOnce:"once"};d.each(k,function(a,b){g[b]=function(b,c,e){var f=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=d.uniqueId("l"));return f[g]=b,e||"object"!=typeof c||(e=this),b[a](c,e,this),this}}),g.bind=g.on,g.unbind=g.off,a.exports=g},function(a,b,c){var d=c(3),e=c(4),f=c(2);a.exports=function(){var a={},b=d.extend(f(),{events:{"widget.onShow":"onWidgetShow","lily.change:ready":"onLilyReadyChange"},initialize:function(){return this.delegateEvents(this,this.events),this},onLilyReadyChange:function(a){a&&this.trigger("lily.onReady")},onWidgetShow:function(a){this.trigger("lily.onWidgetShow")},registerApp:function(b,c){return a[c]=b,b},getRegisteredApp:function(b){return a[b]||void 0},unRegisterApp:function(b){delete a[b]}},e);return b.initialize(),b}()},function(a,b){a.exports=function(){return{sendMessage:function(a,b){var c=JSON.stringify({scope:"client",name:a,data:b});console.log("client: "+a);var d=function(a,b){return function(){var c=a.frame;c?c.postMessage(b,a.origin):setTimeout(d,500)}}(this,c);this.getState("load")?d():this.on("change:load",d)}}}()},function(a,b,c){var d=c(5),e=c(3);a.exports=function(){var a="{{ licence|customerDir|raw }}/css/lily-float.css",b={origin:window.location.origin||e.getOrigin(window.location.href),host:window.location.host||e.getHost(window.location.href),initialize:function(){return this.loadExtStyles(a),e.addEvent(window,"message",e.bind(this.onTargetMessage,this)),this},loadExtStyles:function(a){var b=document.createElement("link");b.rel="stylesheet",b.type="text/css",b.href=a;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)},onTargetMessage:function(a){var b;try{b=JSON.parse(a.data)}catch(c){return}var f,g=b.sender;g&&d.getRegisteredApp(g)&&(f=d.getRegisteredApp(g)),f&&e.getHost(a.origin)===f.host&&a.origin===f.origin&&"saio"===b.scope&&d.trigger(b.name,b.data)}};return b}},function(a,b,c){var d=c(5),e=c(2),f=c(3),g={tagName:"div",html:"{{ widget }}",styles:{display:"none"},attrs:{id:"lily-widget-container"}};a.exports=function(){var a=f.extend(e(),{uid:"widget",el:void 0,id:g.attrs.id,events:{"widget.show":"showWidget","widget.hide":"hideWidget"},state:{shown:!1,firstShow:!0},initialize:function(){return this.el=this.render(g),this.delegateEvents(d,this.events,this),this.forwardStateChangeEvents(d,this.state,this),this.registerDomEvents(),this},render:function(a){var b=this.createEl(a);return this.insertInContainer(b,document.body),b},registerDomEvents:function(){f.addEvent(this.el,"click",f.bind(this.onWidgetClick,this))},onWidgetClick:function(){d.trigger("lily.expand")},showWidget:function(){var a=d.getRegisteredApp("lily");if(!this.getState("shown")&&!a.getState("shown")){if(!a.getState("ready"))return d.once("lily.onReady",this.showWidget,this);this.show(),d.trigger("widget.onShow",this.firstShow),this.setState("firstShow",!1),this.setState("shown",!0)}},hideWidget:function(){this.hide(),this.setState("shown",!1),d.trigger("widget.onHide")}});return a}},function(a,b,c){var d=c(3),e=c(5);a.exports=function(){function a(a,b){if(!d.isString(a))throw Error("first argument should be a string");return f[a]?f[a].call(this,b):void console.warn('unknown config name: "'+a.toString()+'" see api documentation at')}function b(a,b){if(!d.isString(a))throw Error("first argument should be a string");return g[a]?g[a].call(this,b):void console.warn('unknown api method name: "'+a.toString()+'" see api documentation at')}var c=!1,f={"chat.setOperatorGroup":function(a){d.isString(a)||console.error("groupId should be a string containing the operator group id"),e.trigger("config.setOperatorGroup",a)},"box.startExpanded":function(){e.trigger("lily.expand")}},g={"widget.show":function(){e.trigger("widget.show")},"widget.hide":function(){e.trigger("widget.hide")},"box.expand":function(){e.trigger("lily.expand")},"box.shrink":function(){e.trigger("lily.shrink")},"widget.onShow":function(a){d.isFunction(a)&&e.on("widget.onShow",a,{})},"widget.onHide":function(a){d.isFunction(a)&&e.on("widget.onHide",a,{})},"box.onExpand":function(a){d.isFunction(a)&&e.on("lily.onExpand",a,{})},"box.onShrink":function(a){d.isFunction(a)&&e.on("lily.onShrink",a,{})},"app.onReady":function(a){return d.once(function(){var b=e.getRegisteredApp("lily");if(d.isFunction(a)){if(b.getState("ready"))return a();e.once("lily.onReady",a,{})}})},"app.isChatReady":function(){var a=e.getRegisteredApp("lily"),b="chat"===a.getState("activeRoute");return b},"api.onChatSessionStart":"onChatSessionStart","api.onAviSessionStart":"onAviSessionStart","chat.sendMessageToVisitor":function(a){return a&&d.isObject(a)&&d.isString(a.body)?void e.trigger("lily.sendMessageToVisitor",{body:a.body,type:a.type||"simple"}):console.warn("malformed message. See documentation at:")},"chat.onMessageToOperator":function(a){e.on("lily.onMessageToOperator",function(b){d.isFunction(a)&&a(b)})},"avi.addMessage":function(a){return a&&d.isString(a)?void e.trigger("lily.addAviMessage",a):console.warn("malformed message. See documentation at:")},"avi.onAskedQuestion":"onAskedQuestionToAvi"};return{config:a,api:b,calledBeforeLoad:c}}()}]);})(this, document);
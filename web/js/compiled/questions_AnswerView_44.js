lily.AnswerView=Backbone.View.extend({el:".wrapper-answer.active",model:lily.Question,template:_.template($("#answer-question").html()),render:function(){this.$el.append(this.template(this.model.toJSON()));return this},initialize:function(){that=this;$(".content-answer.active").removeClass("active");this.render();this.$el.find("textarea").wysihtml5({"font-styles":false,emphasis:true,lists:false,html:false,link:true,image:false,color:false});$(".content-answer.active").height("100%");this.$el.find(".wysihtml5-toolbar").addClass("hide");this.$el.find("iframe").height("32px");that.$el.find(".wysihtml5-sandbox").contents().find("body").on("keydown",function(e){var nbLines=Math.round($(that.$el.find("textarea")[0]).val().length/35);var heightIframe=Math.max(62,nbLines*32+30);that.$el.find("iframe").height(heightIframe+"px");console.log("heightIframe");console.log(heightIframe);$(".content-answer.active").height("100%")});that.$el.find(".wysihtml5-sandbox").contents().find("body").on("click",function(e){var nbLines=Math.round($(that.$el.find("textarea")[0]).val().length/35);var heightIframe=Math.max(62,nbLines*32+30);that.$el.find("iframe").height(heightIframe+"px");e.stopImmediatePropagation()});that.$el.find(".wysihtml5-sandbox").contents().find("body").on("blur",function(e){console.log("blur");var new_answer=new lily.Question;new_answer.set({title:that.$el.find("textarea").val()});that.$el.find(".wysihtml5-sandbox").contents().find("body").unbind("click");that.$el.find(".wysihtml5-sandbox").contents().find("body").unbind("keydon");that.$el.find(".wysihtml5-sandbox").contents().find("body").unbind("blur");that.$el.empty();new lily.AnswerView({model:new_answer})})},events:{"click .reponse-item":"displayToolBar","keydown edit-reponse-content":"resizeTextArea"},displayToolBar:function(e){lll=e;$(".conteneur-textarea").addClass("hide");$(".reponse-name").removeClass("hide");that.$el.children("li").addClass("toDelete");var nbLines=Math.round($(that.$el.find("textarea")[0]).val().length/30);var heightIframe=Math.max(62,nbLines*32+30);that.$el.find("iframe").height(heightIframe+"px");this.$el.children().addClass("toUpdate");$(".content-answer.active").height("100%");$(e.currentTarget).parent().parent().parent().addClass("toUpdate");$(".toDelete").removeClass("toDelete");this.$el.children().addClass("toDelete");$(e.currentTarget).children(".reponse-name").addClass("hide");$(e.currentTarget).children(".conteneur-textarea").removeClass("hide");this.$el.find(".wysihtml5-toolbar").removeClass("hide");e.stopImmediatePropagation()},resizeTextArea:function(e){alp=this;lp=e;console.log(this);console.log(alp)}});